---
title: "race"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.\

Vital status by Race

Ho: there is no difference between the proportion of patients that died that were White, Black or otherwise, risk = 0.05
Ha: the proportion of patients that died is different in at least one of the race categories

```{r}
pacman::p_load(sjPlot)
sjt.xtab(ICU$Status, ICU$Race, show.col.prc = TRUE)
```

```{r}
Died  <- c( 37, 1, 2 )
Total <- c( 175, 15, 10 )
prop.test(Died, Total)
```

Since the p-value of 0.4046 is greater than 0.05, we fail to reject the null hypothesis that there is no difference between the proportion of patients that died that were White, Black or otherwise.

Further, when conducting a chi-square test with a 5% level of risk of a type 1 error and 2 degrees of freedom, the critical value is 5.99. Since the chi-squared value of 1.8095 is less than this critical value, we, again, fail to reject the null hypothesis that there is no difference between the proportion of patients that died that were White, Black or otherwise.

When looking at the sample estimates and at the table, we see that there was almost no difference between the proportion of White patients that died and the proportion of 'Other' patients that died. However, the proportion of Black patients that died was slightly lower than the White and 'Other' groups.


# Sajiya
# Difference in proportions

We will conduct z-tests between two categorical variables where the dependent variable is Vital status and the independent variable is binary.

Vital status by Service

Ho: there is no difference between the proportion of patients that died in the medical versus surgical group, risk = 0.05
Ha: there is a difference between the proportion of patients that died in the medical versus surgical group

The following code produces a crosstab of the proportions of Service (Medical and Surgical) by Status (Lived or Died).
```{r}
pacman::p_load(sjPlot)
sjt.xtab(ICU$Status, ICU$Service, show.col.prc = TRUE)
```

The following code conducts a z-test and produces a z-value and a p-value for Service.
```{r}
x1<-26; x2<-14; n1<-93; n2<-107
p1<-x1/n1; p2<-x2/n2
p<-(x1+x2)/(n1+n2)  
varp<-p*(1-p)*(1/n1 + 1/n2)  
stdp<-sqrt(varp)  
zp<-(p1 - p2)/stdp 
zp
1-pnorm(zp)
```

When conducting a two-tail z-test with a 5% level of risk of a type 1 error, the critical values are -1.96 and +1.96. The z-value of 2.622729 does not fall within this confidence interval, thus we reject the null hypothesis that there is no difference between the proportion of patients dying in the ICU from medical procedures versus surgical procedures. 

Further, since the p-value of 0.004361436 is less than 0.05, we, again, reject the null hypothesis that the proportions of the two groups are equal. 

Lastly, we can see from the table that more of those that died were there for a medical service and more of those that lived were there for a surgical service.

Vital status by Sex

Ho: there is no difference between the proportion of male and female patients that died, risk = 0.05
Ha: there is a difference between the proportion of male and female patients that died

The following code produces a crosstab of the proportions of Sex (Male and Female) by Status (Lived or Died).
```{r}
pacman::p_load(sjPlot)
sjt.xtab(ICU$Status, ICU$Sex, show.col.prc = TRUE)
```

The following code conducts a z-test and produces a z-value and a p-value for Sex.
```{r}
x1<-24; x2<-16; n1<-124; n2<-76
p1<-x1/n1; p2<-x2/n2
p<-(x1+x2)/(n1+n2)  
varp<-p*(1-p)*(1/n1 + 1/n2)  
stdp<-sqrt(varp)  
zp<-(p1 - p2)/stdp 
zp
1-pnorm(zp)
```

When conducting a two-tail z-test with a 5% level of risk of a type 1 error, the critical values are -1.96 and +1.96. The z-value of -0.2913583 does fall within this confidence interval, thus we fail to reject the null hypothesis that there is no difference between the proportion of male and female patients that died in the ICU.

Further, since the p-value of 0.6146113 is greater than 0.05, we, again, fail to reject the null hypothesis that the proportions of the two groups are equal.

Thus, the proportion of men and women that died in the ICU was equal.

We would, however, like to note that there are significantly more males in this dataset than females, which reduces the integrity of the analysis.

Vital status by Infection

Ho: there is no difference between the proportion of infection probable versus non-infection probable carrying patients that died, risk = 0.05
Ha: there is a difference between the proportion of infection probable versus non-infection probable carrying patients that died

The following code produces a crosstab of the proportions of Infection (No and Yes) by Status (Lived or Died).
```{r}
pacman::p_load(sjPlot)
sjt.xtab(ICU$Status, ICU$Infection, show.col.prc = TRUE)
```

The following code conducts a z-test and produces a z-value and a p-value for Infection.
```{r}
x1<-16; x2<-24; n1<-116; n2<-84
p1<-x1/n1; p2<-x2/n2
p<-(x1+x2)/(n1+n2)  
varp<-p*(1-p)*(1/n1 + 1/n2)  
stdp<-sqrt(varp)  
zp<-(p1 - p2)/stdp 
zp
1-pnorm(zp)
```

When conducting a two-tail z-test with a 5% level of risk of a type 1 error, the critical values are -1.96 and +1.96. The z-value of -2.578807 does not fall within this confidence interval, thus we fail to reject the null hypothesis that there is no difference between the proportion of infection probable versus non-infection probable patients that died.

Further, since the p-value of 0.9950429 is greater than 0.05, we, again, fail to reject the null hypothesis that the proportions of the two groups are equal.

Thus, the proportion of deaths in the infection probable patients is equal to the proportion of deaths in the non-infection probable patients.

Vital status by Renal

Ho: there is no difference between the proportion of patients that died with a history of chronic renal failure versus without, risk = 0.05
Ha: there is a difference between the proportion of patients that died with a history of chronic renal failure versus without

The following code produces a crosstab of the proportions of Renal (No and Yes) by Status (Lived or Died).
```{r}
pacman::p_load(sjPlot)
sjt.xtab(ICU$Status, ICU$Renal, show.col.prc = TRUE)
```

The following code conducts a z-test and produces a z-value and a p-value for Renal.
```{r}
x1<-32; x2<-8; n1<-181; n2<-19
p1<-x1/n1; p2<-x2/n2
p<-(x1+x2)/(n1+n2)  
varp<-p*(1-p)*(1/n1 + 1/n2)  
stdp<-sqrt(varp)  
zp<-(p1 - p2)/stdp 
zp
1-pnorm(zp)
```

When conducting a two-tail z-test with a 5% level of risk of a type 1 error, the critical values are -1.96 and +1.96. The z-value of -2.532143 does not fall within this confidence interval, thus we fail to reject the null hypothesis that there is no difference between the proportion of patients that died with a history of chronic renal failure versus without.

Further, since the p-value of 0.9943316 is greater than 0.05, we, again, fail to reject the null hypothesis that the proportions of the two groups are equal.

Thus, the proportion of deaths in patients with a history of chronic renal failure is equal to the proportion of deaths in patients with no history of chronic renal failure.

Vital Status by CPR

Ho: there is no difference between the proportion of deaths in patients who recieved CPR upon admission versus patients who did not, risk = 0.05
Ha: there is a difference between the proportion of deaths in patients who recieved CPR upon admission versus patients who did not

The following code produces a crosstab of the proportions of CPR (No and Yes) by Status (Lived or Died).
```{r}
pacman::p_load(sjPlot)
sjt.xtab(ICU$Status, ICU$CPR, show.col.prc = TRUE)
```

The following code conducts a z-test and produces a z-value and a p-value for CPR.
```{r}
x1<-33; x2<-7; n1<-187; n2<-13
p1<-x1/n1; p2<-x2/n2
p<-(x1+x2)/(n1+n2)  
varp<-p*(1-p)*(1/n1 + 1/n2)  
stdp<-sqrt(varp)  
zp<-(p1 - p2)/stdp 
zp
1-pnorm(zp)
```

When conducting a two-tail z-test with a 5% level of risk of a type 1 error, the critical values are -1.96 and +1.96. The z-value of -3.155115 does not fall within this confidence interval, thus we fail to reject the null hypothesis that there is no difference between the proportion of deaths in patients who recieved CPR upon admission versus patients who did not.

Further, since the p-value of 0.9991978 is greater than 0.05, we, again, fail to reject the null hypothesis that the proportions of the two groups are equal.

Thus, the proportion of deaths in patients who recieved CPR upon admission is equal to the proportion of deaths in patients who did not recieve CPR upon admission.

Vital status by Cancer

Ho: there is no difference between the proportions of patients that died in the cancer versus non-cancer group, risk = 0.05
Ha: there is a difference between the proportions of patients that died in the cancer versus non-cancer group

The following code produces a crosstab of the proportions of Cancer (No and Yes) by Status (Lived or Died).
```{r}
pacman::p_load(sjPlot)
sjt.xtab(ICU$Status, ICU$Cancer, show.col.prc = TRUE)
```

The following code conducts a z-test and produces a z-value and a p-value for Cancer.
```{r}
x1<-36; x2<-4; n1<-180; n2<-20
p1<-x1/n1; p2<-x2/n2
p<-(x1+x2)/(n1+n2)  
varp<-p*(1-p)*(1/n1 + 1/n2)  
stdp<-sqrt(varp)  
zp<-(p1 - p2)/stdp 
zp
1-pnorm(zp)
```

When conducting a two-tail z-test with a 5% level of risk of a type 1 error, the critical values are -1.96 and +1.96. The z-value of 0 falls within this confidence interval, thus we fail to reject the null hypothesis that there is no difference between the proportions of patients that died with versus without cancer as part of the present problem.

Further, since the p-value of 0.5 is greater than 0.05, we, again, fail to reject the null hypothesis that the proportions of the Cancer versus non-cancer patients that died are equal.

Thus, there are equal proportions of those who died with cancer as part of the present problem and without, as well as equal proportions of those who lived with cancer as part of the present problem and without.

Vital status by Previous

Ho: there is no difference between the proportion of patients that died with versus without previous admission to an ICU within 6 months, risk = 0.05
Ha: there is a difference between the proportion of patients that died with versus without previous admission to an ICU within 6 months

The following code produces a crosstab of the proportions of Previous (No and Yes) by Status (Lived or Died).
```{r}
pacman::p_load(sjPlot)
sjt.xtab(ICU$Status, ICU$Previous, show.col.prc = TRUE)
```

The following code conducts a z-test and produces a z-value and a p-value for Previous.
```{r}
x1<-33; x2<-7; n1<-170; n2<-30
p1<-x1/n1; p2<-x2/n2
p<-(x1+x2)/(n1+n2)  
varp<-p*(1-p)*(1/n1 + 1/n2)  
stdp<-sqrt(varp)  
zp<-(p1 - p2)/stdp 
zp
1-pnorm(zp)
```

When conducting a two-tail z-test with a 5% level of risk of a type 1 error, the critical values are -1.96 and +1.96. The z-value of -0.4950738 falls within this confidence interval, thus we fail to reject the null hypothesis that there is no difference between the proportion of patients that died with versus without previous admission to an ICU within 6 months of the current admission. 

Further, since the p-value of 0.689726 is greater than 0.05, we, again, fail to reject the null hypothesis that there is no difference between the proportion of patients that died whether or not they were previously admitted to the ICU within the past 6 months.

Lastly, we see from the table that there was a lower percentage of patients that died with no prior ICU admission than patients that died with prior ICU admission.

Vital status by Type

Ho: there is no difference between the proportion of patients that died in the elective admission group versus the emergency admission group, risk = 0.05
Ha: there is a difference between the proportion of patients that died in the elective admission group versus the emergency admission group

The following code produces a crosstab of the proportions of Type (Elective and Emergency) by Status (Lived or Died).
```{r}
pacman::p_load(sjPlot)
sjt.xtab(ICU$Status, ICU$Type, show.col.prc = TRUE)
```

The following code conducts a z-test and produces a z-value and a p-value for Type.
```{r}
x1<-2; x2<-38; n1<-53; n2<-147
p1<-x1/n1; p2<-x2/n2
p<-(x1+x2)/(n1+n2)  
varp<-p*(1-p)*(1/n1 + 1/n2)  
stdp<-sqrt(varp)  
zp<-(p1 - p2)/stdp 
zp
pnorm(zp)
```

When conducting a two-tail z-test with a 5% level of risk of a type 1 error, the critical values are -1.96 and +1.96. The z-value of -3.444743 does not fall within this confidence interval, thus we reject the null hypothesis that there is no difference between the proportion of patients that died in the elective admission group versus the emergency admission group.

Further, since the p-value of 0.000285801 is less than 0.05, we, again, reject the null hypothesis that the proportions of the two groups are equal. 

We can see from the table that the emergency admission type had a higher proportion of deaths than the elective admission type did.

We will now conduct a prop.test for categorical variables where the independent variable has more than 2 subgroups.

Vital status by Age

Ho: there is no difference between the proportion of patients that died across the 5 age groups, risk = 0.05
Ha: the proportion of patients that died is different in at least one of the 5 age groups

We will now bin the Age variable by equal-width bins: 

```{r}
ICU$Age.Binned <- with(ICU, binVariable(Age, bins=5, method='intervals', labels=c('Age group 1','Age group 2','Age group 3','Age group 4',
  'Age group 5')))
```

The following code produces a crosstab of the proportions of Age (Groups 1-5) by Status (Lived or Died).
```{r}
pacman::p_load(sjPlot)
sjt.xtab(ICU$Status, ICU$Age.Binned, show.col.prc = TRUE)
```

The following code conducts a z-test and produces a p-value, a chi-squared value and sample proportion estimates for Age.
```{r}
Died  <- c( 2, 2, 10, 18, 8 )
Total <- c( 31, 19, 46, 75, 29 )
prop.test(Died, Total)
```

Since the p-value of 0.1646 is greater than 0.05, we fail to reject the null hypothesis that there is no difference between the proportion of patients that died across the 5 age groups. 

Further, when conducting a chi-square test with a 5% level of risk of a type 1 error and 4 degrees of freedom, the critical value is 9.49. Since the chi-squared value of 6.5023 is less than this critical value, we, again, fail to reject the null hypothesis that there is no difference between the proportion of patients that died across the 5 age groups.

However, we can see from the sample estimates produced by the proportions test that Age group 1 and Age group 2 have slightly lower proportions than age groups 3, 4 and 5. Thus, the number of patients that died in age group 1 (the youngest age group) and age group 2 is much lower than the rest. The greatest proportion of patients that died is in group 5 (the oldest age group). Overall, proportions of death increased slightly in each age group, with closer proportions in the 3 oldest age groups and very low proportions in the 2 youngest age groups.

Vital status by Systolic Blood Pressure

Ho: there is no difference between the proportion of patients that died across the 6 systolic blood pressure level groups, risk = 0.05
Ha: the proportion of patients that died is different in at least one of the 6 systolic blood pressure level groups

We grouped Systolic into medically characterized categories of hypotension, normal blood pressure, elevated blood pressure and stage 1, 2 and 3 hypertension. Hypotension is characterized by a blood pressure level of less than 80mmHg, normal blood pressure is characterized by a blood pressure level between 80 to 120mmHg, elevated blood pressure is characterized by a blood pressure level between 120 and 129mmHg, stage 1 hypertension is characterized by a blood pressure level 130-139mmHg, stage 2 hypertension is characterized by a blood pressure level 140-180mmHg, and stage 3 hypertension is characterized by a blood pressure level greater than 180mmHg.
```{r}
ICU <- 
  within(ICU, {
  Systolic.grouped <- Recode(Systolic, 
  '0:80="hypotension"; 80:120="normal"; 120:129="elevated"; 130:139="stage 1 hypertension"; 140:180="stage 2 hypertension"; 180:260="stage 3 hypertension"; ;',
   as.factor=TRUE)
})
```

The following code produces a crosstab of the proportions of Systolic (Hypotension, normal, elevated, 3 categories of hypertension) by Status (Lived or Died).
```{r}
pacman::p_load(sjPlot)
sjt.xtab(ICU$Status, ICU$Systolic.grouped, show.col.prc = TRUE)
```

The following code conducts a z-test and produces a p-value, a chi-squared value and sample proportion estimates for Systolic.
```{r}
Died  <- c( 3, 9, 9, 6, 11, 2 )
Total <- c( 17, 12, 61, 30, 65, 15 )
prop.test(Died, Total)
```

Since the p-value of 0.0001667 is less than 0.05, we will reject the null hypothesis that there is no difference between the proportion of patients that died in the 6 systolic blood pressure level groups. We can see from the sample estimates that the proportions are indeed different between the 6 groups, with the highest proportion in the hypotenstion range and in the stage 1 hypertension range. The proportions in the elevated, normal, stage 2 hypertension and stage 3 hypertension groups are much lower and are quite close to each other. Thus, the hypotension and stage 1 hypertension groups had higher proportions of patients that died. 

Further, when conducting a chi-square test with a 5% level of risk of a type 1 error and 5 degrees of freedom, the critical value is 11.07. Since the chi-squared value of 24.597 is greater than this critical value, we will, again, reject the null hypothesis that there is no difference between the proportion of patients that died in the 6 systolic blood pressure level groups.

Vital status by Heart Rate

Ho: there is no difference between the proportion of patients that died across the bradychardia, normal heart rate and elevated heart rate groups, risk = 0.05
Ha: the proportion of patients that died is different in at least one of the 3 heart rate categories

We grouped heart rate into medically characterized categories of bradycardia, normal heart rate and tachycardia. Bradycardia is characterized by a heart rate less than 60 beats per minute, normal heart rate is characterized by a heart rate between 60-100 beats per minute, and tachycardia is characterized by a heart rate greater than 100 beats per minute.

```{r}
ICU <- 
  within(ICU, {
  HeartRate.grouped <- Recode(HeartRate, 
  '0:60="bradycardia"; 60:100="normal"; 100:200="tachycardia"',
   as.factor=TRUE)
})
```

The following code produces a crosstab of the proportions of Status (Bradycardia, Normal and Tachycardia) by Status (Lived or Died).
```{r}
pacman::p_load(sjPlot)
sjt.xtab(ICU$Status, ICU$HeartRate.grouped, show.col.prc = TRUE)
```

The following code conducts a z-test and produces a p-value, a chi-squared value and sample proportion estimates for Heart Rate.
```{r}
Died  <- c( 3, 16, 21 )
Total <- c( 15, 80, 105 )
prop.test(Died, Total)
```

Since the p-value of 1 is greater than 0.05, we fail to reject the null hypothesis that there is no difference between proportion of patients that died across the bradychardia, normal heart rate and elevated heart rate groups. An exact p-value of 1 means that the difference in proportions of patients that died between the 3 heart rate groups is exactly 0. Thus, there were an equal number of patients that died with bradycardia, normal heart rate and elevated heart rate.

Further, when conducting a chi-square test with a 5% level of risk of a type 1 error and 2 degrees of freedom, the critical value is 5.99. Since the chi-squared value of 0 is lower than this critical value, we, again, fail to reject the null hypothesis that there is no difference between the proportion of patients that died having bradychardia, normal heart rate and elevated heart rate.

Vital status by Consciousness

Ho: there is no difference between the proportion of patients that died across the Conscious, Deep Stupor and Coma groups, risk = 0.05
Ha: the proportion of patients that died is different in at least one of the Conscious, Deep Stupor and Coma groups

The following code produces a crosstab of the proportions of Consciousness (Conscious, Deep Stupor and Coma) by Status (Lived or Died).
```{r}
pacman::p_load(sjPlot)
sjt.xtab(ICU$Status, ICU$Consciousness, show.col.prc = TRUE)
```

The following code conducts a z-test and produces a p-value, a chi-squared value and sample proportion estimates for Consciousness.
```{r}
Died  <- c( 27, 5, 8 )
Total <- c( 185, 5, 10 )
prop.test(Died, Total)
```

Since the p-value of 1.091e-10 is less than 0.05, we will reject the null hypothesis that there is no difference between the proportion of patients that died across the Conscious, Deep Stupor and Coma groups. 

Further, when conducting a chi-square test with a 5% level of risk of a type 1 error and 2 degrees of freedom, the critical value is 5.99. Since the chi-squared value of 45.878 is greater than this critical value, we will, again, reject the null hypothesis that there is no difference between the proportion of patients that died across the 3 Consciousness groups.

With a proportion of 1, the Deep Stupor group had the highest proportion of patients that died as all the patients with a deep stupor died. The Coma group has the second highest proportion of patients that died with a sample estimate of 80% dying. The lowest number of deaths was in the group of patients that had no coma or stupor, which is expected. Those with a deep stupor had a higher proportion of deaths than those in a coma.

From the tests of equal proportions, we note that the the following variables had a statistically significant impact on the Vital status of the patient: Service (type of procedure), Type (of admission) and Conciousness.

The following variables were not significant predictors of Vital status of the patient:  Sex, Infection, Renal, CPR, Cancer, Previous (ICU admission within the last 6 months), Age, Systolic Blood Pressure, and Heart rate.
