---
title: "ICU Admissions Term Project, eH705"
author: "Group XYZ"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document: 
    number_sections: TRUE
    code_folding: hide
    toc: yes
    toc_float: 
      toc_collapsed: true
    includes:
      after_body: footer.html
    theme: journal
    fig_height: 4
    fig_width: 4
    fig_align: center
    font_family: Times New Roman, Times, serif
    font_size: 2.5em
    linestretch: 1.5
---

```{r setup, eval=TRUE, include=FALSE}  
knitr::opts_chunk$set( comment=NA, eval=TRUE,  echo=TRUE, warning=FALSE, message=FALSE, error=FALSE, root.dir = "C:/Users/ekene/Documents/eH705_Project") 
pacman::p_load(psych, ggplot2, DT, sjPlot, knitr, DescTools,
               ggcorrplot, qgraph, corrr, tidyverse, Hmisc )
```

```{r echo=FALSE}
# include this code chunk as-is to set options
knitr::opts_chunk$set(comment=NA, prompt=TRUE, out.width=750, fig.height=8, fig.width=8)
library(Rcmdr)
library(car)
library(RcmdrMisc)
```


```{r echo=FALSE}
# include this code chunk as-is to enable 3D graphs
library(rgl)
knitr::knit_hooks$set(webgl = hook_webgl)
```

# About the ICU Admissions Dataset

Description: The data consist of 200 subjects from a larger study on the survival of patients following admission to an adult intensive care unit (ICU). The study used logistic regression to predict the probability of survival for these patients until their discharge from the hospital. The dependent variable is the binary variable Vital Status (STA). Nineteen possible predictor variables, both discrete and continuous, were also observed. 
Number of cases: 200 
Variable Names: 

  1.	ID: ID number of the patient 
  2.	STA: Vital status (0 = Lived, 1 = Died) 
  3.	AGE: Patient's age in years 
  4.	SEX: Patient's sex (0 = Male, 1 = Female) 
  5.	RACE: Patient's race (1 = White, 2 = Black, 3 = Other) 
  6.	SER: Service at ICU admission (0 = Medical, 1 = Surgical) 
  7.	CAN: Is cancer part of the present problem? (0 = No, 1 = Yes) 
  8.	CRN: History of chronic renal failure (0 = No, 1 = Yes) 
  9.	INF: Infection probable at ICU admission (0 = No, 1 = Yes) 
  10.	CPR: CPR prior to ICU admission (0 = No, 1 = Yes) 
  11.	SYS: Systolic blood pressure at ICU admission (in mm Hg) 
  12.	HRA: Heart rate at ICU admission (beats/min) 
  13.	PRE: Previous admission to an ICU within 6 months (0 = No, 1 = Yes) 
  14.	TYP: Type of admission (0 = Elective, 1 = Emergency) 
  15.	FRA: Long bone, multiple, neck, single area, or hip fracture (0 = No, 1 = Yes) 
  16.	PO2: PO2 from initial blood gases (0 = >60, 1 = ²60) 
  17.	PH: PH from initial blood gases (0 = ³7.25, 1 <7.25) 
  18.	PCO: PCO2 from initial blood gases (0 = ²45, 1 = >45) 
  19.	BIC: Bicarbonate from initial blood gases (0 = ³18, 1 = <18) 
  20.	CRE: Creatinine from initial blood gases (0 = ²2.0, 1 = >2.0) 
  21.	LOC: Level of consciousness at admission (0 = no coma or stupor, 1= deep stupor, 2 = coma) 

# Reading in the ICU Admissions Dataset
```{r}
ICU <- read.table("./ICUAdmissions.csv", header=TRUE, sep=",", na.strings="NA", dec=".", strip.white=TRUE)
```

```{r}
str(ICU)
```

## Findings

The ICU Admissions dataset consists of 200 observations with 21 variables. From the following observations we found;

  1. The dependent variable is the binary variable Vital Status (Status).   
  2. Nineteen possible predictor variables, both discrete and continuous, were also observed. 
  3. Most of the variables are integer but from information about the data, most of the variables can be recoded to factor variables.  
  4. There are only four variables that can be left as numerical variables others can be recoded to categorical/factor variables.  
  5. There would be a need to recode the categorical variables to factors.  
  6. There are no missing data  
  

# Converting Numerical variables to Factor Variables

Labelling the factor levels helps with comparative analysis and visualization

```{r}
ICU <- within(ICU, {
  Status <- factor(Status, labels=c('Lived','Died'))
  Sex <- factor(Sex, labels=c('Male','Female'))
  Race <- factor(Race, labels=c('White','Black','Other'))
  Service <- factor(Service, labels=c('Medical','Surgical'))
  Cancer <- factor(Cancer, labels=c('No','Yes'))
  Renal <- factor(Renal, labels=c('No','Yes'))
  Infection <- factor(Infection, labels=c('No','Yes'))
  CPR <- factor(CPR, labels=c('No','Yes'))
  Previous <- factor(Previous, labels=c('No','Yes'))
  Type <- factor(Type, labels=c('Elective','Emergency'))
  Fracture <- factor(Fracture, labels=c('No','Yes'))
  PCO2 <- factor(PCO2, labels=c('No','Yes'))
  PH <- factor(PH, labels=c('No','Yes'))
  PO2 <- factor(PO2, labels=c('No','Yes'))
  Bicarbonate <- factor(Bicarbonate, labels=c('No','Yes'))
  Creatinine <- factor(Creatinine, labels=c('No','Yes'))
  Consciousness <- factor(Consciousness, labels=c('Conscious','Deep Stupor','Coma'))
})
```

## Viewing a few rows of the recorded dataset
```{r}
headTail(ICU) %>% datatable(rownames = TRUE, filter="top", options = list(pageLenght = 10, scrollX=T))%>% formatRound(columns=c(1:17), digits=0)
```

## Saving new recoded dataset
```{r}
# write.csv(ICU, file="ICUAdmissions_recoded.csv", row.names=FALSE)
```

# Data Exploration - Statistical summaries and Graphing of variables

```{r}
str(ICU)
```

**Findings**
* The following variables were successfully recoded; Status, Sex, Race, Service, Cancer, Renal, Infection, CPR, Previous, Type,Fracture, PCO2,PH, PO2, Bicarbonate, Creatinine, and Consciousness. 

## Statistical summary of the recoded dataset
```{r}
summary(ICU)
```

## Numerical Summary of Int VAriables
```{r}
numSummary(ICU[,c("Age", "HeartRate", "Systolic"), drop=FALSE], statistics=c("mean", "sd", "IQR", 
  "quantiles"), quantiles=c(0,.25,.5,.75,1))
```

## Findings

* Age ranges from 16-92 years old with a mean of 57.55 and median of 63
* Systolic blood pressure ranges from 36-256 with a mean of 132.3 and median of 130
* Heart rate ranges from 39-192 beats per minute with a mean of 98.92 and median of 96

# Graphing

## Examining the variables distribution

```{r echo=FALSE}
xray:: distributions(ICU)
```

## Distribution of Vital Status by the factor variables
```{r}
library(ggplot2)
f01<-ggplot(ICU, aes(x=Sex, fill = Status)) +
 theme_bw() +
 geom_bar() +
 labs(y = "Patient Count",
      title = "Vital Status by Sex")

f02<-ggplot(ICU, aes(x=Race, fill = Status)) +
 theme_bw() +
 geom_bar() +
 labs(y = "Patient Count",
      title = "Vital Status by Race")
f03<-ggplot(ICU, aes(x=Service, fill = Status)) +
 theme_bw() +
 geom_bar() +
 labs(y = "Patient Count",
      title = "Vital Status by Service")

f04<-ggplot(ICU, aes(x=Cancer, fill = Status)) +
 theme_bw() +
 geom_bar() +
 labs(y = "Patient Count",
      title = "Vital Status by Cancer")

library(Rmisc)
multiplot(f01, f02, f03, f04,  layout=matrix(c(1:4), nrow=2, byrow=TRUE))
```

```{r}

f05<-ggplot(ICU, aes(x=Renal, fill = Status)) +
 theme_bw() +
 geom_bar() +
 labs(y = "Patient Count",
      title = "Vital Status by Renal")

f06<-ggplot(ICU, aes(x=Infection, fill = Status)) +
 theme_bw() +
 geom_bar() +
 labs(y = "Patient Count",
      title = "Vital Status by Infection")

f07<-ggplot(ICU, aes(x=CPR, fill = Status)) +
 theme_bw() +
 geom_bar() +
 labs(y = "Patient Count",
      title = "Vital Status by CPR")

f08<-ggplot(ICU, aes(x=Previous, fill = Status)) +
 theme_bw() +
 geom_bar() +
 labs(y = "Patient Count",
      title = "Vital Status by Previous")

library(Rmisc)
multiplot(f05, f06, f07, f08,  layout=matrix(c(1:4), nrow=2, byrow=TRUE))
``` 

```{r}

f09<-ggplot(ICU, aes(x=Type, fill = Status)) +
 theme_bw() +
 geom_bar() +
 labs(y = "Patient Count",
      title = "Vital Status by Type")

f10<-ggplot(ICU, aes(x=Fracture, fill = Status)) +
 theme_bw() +
 geom_bar() +
 labs(y = "Patient Count",
      title = "Vital Status by Fracture")

f11<-ggplot(ICU, aes(x=PO2, fill = Status)) +
 theme_bw() +
 geom_bar() +
 labs(y = "Patient Count",
      title = "Vital Status by PO2")

f12<-ggplot(ICU, aes(x=PH, fill = Status)) +
 theme_bw() +
 geom_bar() +
 labs(y = "Patient Count",
      title = "Vital Status by PH")

library(Rmisc)
multiplot(f09, f10, f11, f12,  layout=matrix(c(1:4), nrow=2, byrow=TRUE))
```

```{r}
f13<-ggplot(ICU, aes(x=PCO2, fill = Status)) +
 theme_bw() +
 geom_bar() +
 labs(y = "Patient Count",
      title = "Vital Status by PCO2")

f14<-ggplot(ICU, aes(x=Bicarbonate, fill = Status)) +
 theme_bw() +
 geom_bar() +
 labs(y = "Patient Count",
      title = "Vital Status by Bicarbonate")

f15<-ggplot(ICU, aes(x=Creatinine, fill = Status)) +
 theme_bw() +
 geom_bar() +
 labs(y = "Patient Count",
      title = "Vital Status by Creatinine")

f16<-ggplot(ICU, aes(x=Consciousness, fill = Status)) +
 theme_bw() +
 geom_bar() +
 labs(y = "Patient Count",
      title = "Vital Status by Consciousness")


library(Rmisc)
multiplot(f13, f14, f15, f16, layout=matrix(c(1:4), nrow=2, byrow=TRUE))
```



## Plotting the density Distribution of the Numeric Variable

```{r}
d01 <- ggplot(ICU, aes(x=Age)) +
 geom_density(fill="green") +
 ggtitle("Age") +
 theme(axis.title.x=element_text(size=16, face="bold", colour="blue")) +
 theme(axis.text.x=element_text(size=14 )) +
 annotate("text", x=0.8, y=-0.001, label="Base=315",  size=4)

d02 <- ggplot(ICU, aes(x=Systolic)) +
 geom_density(fill="green") +
 ggtitle("Systolic") +
 theme(axis.title.x=element_text(size=16, face="bold", colour="blue")) +
 theme(axis.text.x=element_text(size=14 )) +
 annotate("text", x=0.8, y=-0.001, label="Base=315",  size=4)

d03 <- ggplot(ICU, aes(x=HeartRate)) +
 geom_density(fill="green") +
 ggtitle("HeartRate") +
 theme(axis.title.x=element_text(size=16, face="bold", colour="blue")) +
 theme(axis.text.x=element_text(size=14 )) +
 annotate("text", x=0.8, y=-0.001, label="Base=315",  size=4)

d04 <- ggplot(ICU, aes(x=ID)) +
 geom_density(fill="green") +
 ggtitle("ID") +
 theme(axis.title.x=element_text(size=16, face="bold", colour="blue")) +
 theme(axis.text.x=element_text(size=14 )) +
 annotate("text", x=0.8, y=-0.001, label="Base=315",  size=4)

multiplot(d01, d02, d03, d04, layout=matrix(c(1:4), nrow=2, byrow=TRUE))

```


## Density plot of Vital Status by Numeric variables 
```{r}
n01<-ggplot(ICU, aes(x=Age, fill = Status)) +
  theme_bw() +
      geom_density(alpha=0.5) +
  labs(y = "Density",
       title = "Density distribution of Vital Status by Age")

n02<-ggplot(ICU, aes(x=Systolic, fill = Status)) +
  theme_bw() +
      geom_density(alpha=0.5) +
  labs(y = "Density",
       title = "Density distribution of Vital Status Systolic")

n03<-ggplot(ICU, aes(x=HeartRate, fill = Status)) +
  theme_bw() +
      geom_density(alpha=0.5) +
  labs(y = "Density",
       title = "Density distribution of Vital Status HeartRate")

n04<-ggplot(ICU, aes(x=Age, fill = Status)) +
  theme_bw() +
  facet_wrap(~ Sex) +
      geom_density(alpha=0.5) +
  labs(y = "Density",
       title = "Density distribution of Vital Status in male and female patients by Age")

multiplot(n01, n02, n03, n04, layout=matrix(c(1:4), nrow=2, byrow=TRUE))
```

# Observations

  - There are more male than female in the population.
  - The number of patient who live is higher than the population who died
  - More Patients from the population aged 50 and above died in both male and female
  - The female population experienced more death than men of the same age bracket as 
  - The desity plot is peaked at the top at the age 75 for both male and female meaning more patients aged 75 died.

# Distribution
```{r}
with(ICU, qqPlot(Systolic, dist="norm", id=list(method="y", n=2, 
  labels=rownames(ICU)), main="Systolic"))
```

```{r}
normalityTest(~Systolic, test="shapiro.test", data=ICU)
```

```{r}
with(ICU, qqPlot(HeartRate, dist="norm", id=list(method="y", n=2, 
  labels=rownames(ICU)), main="Heartrate"))
```

```{r}
normalityTest(~HeartRate, test="shapiro.test", data=ICU)
```

```{r}
with(ICU, qqPlot(Age, dist="norm", id=list(method="y", n=2, 
  labels=rownames(ICU)), main="Age"))
```

```{r}
normalityTest(~Age, test="shapiro.test", data=ICU)
```

# Differences in Means

## Summary Statistics 

```{r}
numSummary(ICU[,c("Age", "Systolic", "HeartRate"), drop=FALSE], groups=ICU$Status, statistics=c("mean", "sd", "se(mean)"),quantiles=c(0,.25, .5, .75,1))
```

```{r}
library(psych)
describeBy(ICU, ICU$Status)
```

## Age by Status
__Ho:__ the variances for Lived and Died are equal  
__Ha:__ the variances are different

__Ho:__ the means are equal  
__Ha:__ the means are different

The following is the comparison of variances between the two Status groups for Age.

```{r}
with(ICU, tapply(Age, Status, var, na.rm=TRUE))
```

The following code produces the result of the LeveneTest for testing homogeneity of variances.

```{r}
leveneTest(Age ~ Status, data=ICU, center="median")
```

Since the p value = 0.07855 for testing the homogeneity of variances is greater than 0.05, we retain the null hypothesis with a 5% risk of a type 1 error and conclude that the variances for Lived and Died are equal. As such, the Student t-test is used to analyze whether there was a significant difference in means.


```{r}
t.test(Age~Status, alternative='two.sided', conf.level=.95, var.equal=TRUE, data=ICU)
qt(c(0.025), df=314, lower.tail=TRUE)
```

As the p-value = 0.007211, 0 is not within the confidence intervals of -16.35688 to -2.59312 and t = -2.7151 is less than -1.967548, we reject the null hypothesis and conclude that the means for Age for the groups Lived and Died are not the same. 


## HeartRate by Status
__Ho:__ the variances for Lived and Died are equal  
__Ha:__ the variances are different

__Ho:__ the means are equal  
__Ha:__ the means are different

The following is the comparison of variances between the two Status groups for HeartRate.
```{r}
with(ICU, tapply(HeartRate, Status, var, na.rm=TRUE))
```

The following code produces the result of the LeveneTest for testing homogeneity of variances.
```{r}
leveneTest(HeartRate ~ Status, data=ICU, center="median")
```

Since the p-value = 0.929 for testing the homogeneity of variances is greater than 0.05, we retain the null hypothesis with a 5% risk of a type 1 error and conclude that the variances for Lived and Died are equal. As such, the Student t-test is used to analyze whether there was a significant difference in means.

```{r}
t.test(HeartRate~Status, alternative='two.sided', conf.level=.95, var.equal=TRUE, data=ICU)
qt(c(0.025), df=314, lower.tail=TRUE)
```

As the p-value = 0.6553, 0 is within the confidence intervals of -11.496845 to 7.246845 and t = -0.44714 is greater than -1.967548, we retain the null hypothesis at a 5% risk level of a type 1 error and conclude that the means for HeartRate are the same among those that lived and those that died. 

## Systolic by Status
__Ho:__ the variances for Lived and Died are equal  
__Ha:__ the variances are different  

__Ho:__ the means are equal  
__Ha:__ the means are different

The following is the comparison of variances between the two Status groups for Systolic.
```{r}
with(ICU, tapply(Systolic, Status, var, na.rm=TRUE))
```

The following code produces the result of the LeveneTest for testing homogeneity of variances.
```{r}
leveneTest(Systolic ~ Status, data=ICU, center="median")
```

Since the p-value = 0.04205 for testing the homogeneity of variances is less than 0.05, we reject the null hypothesis with a 5% risk of a type 1 error and conclude that the variances for Lived and Died are not equal. As such, the Welch two Sample t-test is used to analyze whether there was a significant difference in means. 

```{r}
t.test(Systolic~Status, alternative="two.sided", conf.level=.95, var.equal=FALSE, data=ICU)
qt(c(0.025), df=314, lower.tail=TRUE)
```

As the p-value = 0.01856, 0 is not within the confidence intervals of  2.938642 to 30.698858 and t = 2.4341 is greater than 1.9675, we reject the null hypothesis at a 5% risk level of a type 1 error and conclude that the means for systolic blood pressure are not the same among those that lived and those that died. 


## Age by Sex
__Ho:__ the variances for Lived and Died are equal  
__Ha:__ the variances are different

__Ho:__ the means are equal  
__Ha:__ the means are different

The following is the comparison of variances between the two Sex groups for Age.

```{r}
with(ICU, tapply(Age, Sex, var, na.rm=TRUE))
```

The following code produces the result of the LeveneTest for testing homogeneity of variances.
```{r}
leveneTest(Age ~ Sex, data=ICU, center="median")
```

Since the p-value = 0.7344 for testing the homogeneity of variances is greater than 0.05, we retain the null hypothesis with a 5% risk of a type 1 error and conclude that the variances for Lived and Died are equal. As such, the Student t-test is used to analyze whether there was a significant difference in means.

```{r}
t.test(Age~Sex, alternative='two.sided', conf.level=.95, var.equal=TRUE, data=ICU)
qt(c(0.025), df=314, lower.tail=TRUE)
```

As the p-value = 0.1759, 0 is within the confidence intervals of -9.708824 to 1.789469 and t = -1.3582 is greater than - 1.9675, we retain the null hypothesis at a 5% risk level of a type 1 error and conclude that the means for systolic blood pressure are the same between the two groups.


# Difference in proportions

We will conduct z-tests between two categorical variables where the dependent variable is Vital status and the independent variable is binary.

Vital status by Service

Ho: there is no difference between the proportion of patients that died in the medical versus surgical group, risk = 0.05
Ha: there is a difference between the proportion of patients that died in the medical versus surgical group

```{r}
pacman::p_load(sjPlot)
sjt.xtab(ICU$Status, ICU$Service, show.col.prc = TRUE)
```

```{r}
x1<-26; x2<-14; n1<-93; n2<-107
p1<-x1/n1; p2<-x2/n2
p<-(x1+x2)/(n1+n2)  
varp<-p*(1-p)*(1/n1 + 1/n2)  
stdp<-sqrt(varp)  
zp<-(p1 - p2)/stdp 
zp
1-pnorm(zp)
```

When conducting a two-tail z-test with a 5% level of risk of a type 1 error, the critical values are -1.96 and +1.96. The z-value of 2.622729 does not fall within this confidence interval, thus we reject the null hypothesis that there is no difference between the proportion of patients dying in the ICU from medical procedures versus surgical procedures. 

Further, since the p-value of 0.004361436 is less than 0.05, we, again, reject the null hypothesis that the proportions of the two groups are equal. 

Lastly, we can see from the table that more of those that died were there for a medical service and more of those that lived were there for a surgical service.

Vital status by Cancer

Ho: there is no difference between the proportions of patients that died in the cancer versus non-cancer group, risk = 0.05
Ha: there is a difference between the proportions of patients that died in the cancer versus non-cancer group

```{r}
pacman::p_load(sjPlot)
sjt.xtab(ICU$Status, ICU$Cancer, show.col.prc = TRUE)
```

```{r}
x1<-36; x2<-4; n1<-180; n2<-20
p1<-x1/n1; p2<-x2/n2
p<-(x1+x2)/(n1+n2)  
varp<-p*(1-p)*(1/n1 + 1/n2)  
stdp<-sqrt(varp)  
zp<-(p1 - p2)/stdp 
zp
1-pnorm(zp)
```

When conducting a two-tail z-test with a 5% level of risk of a type 1 error, the critical values are -1.96 and +1.96. The z-value of 0 falls within this confidence interval, thus we fail to reject the null hypothesis that there is no difference between the proportions of patients that died with versus without cancer as part of the present problem.

Further, since the p-value of 0.5 is greater than 0.05, we, again, fail to reject the null hypothesis that the proportions of the Cancer versus non-cancer patients that died are equal.

Thus, there are equal proportions of those who died with cancer as part of the present problem and without, as well as equal proportions of those who lived with cancer as part of the present problem and without.

Vital status by Previous

Ho: there is no difference between the proportion of patients that died with versus without previous admission to an ICU within 6 months, risk = 0.05
Ha: there is a difference between the proportion of patients that died with versus without previous admission to an ICU within 6 months

```{r}
pacman::p_load(sjPlot)
sjt.xtab(ICU$Status, ICU$Previous, show.col.prc = TRUE)
```

```{r}
x1<-33; x2<-7; n1<-170; n2<-30
p1<-x1/n1; p2<-x2/n2
p<-(x1+x2)/(n1+n2)  
varp<-p*(1-p)*(1/n1 + 1/n2)  
stdp<-sqrt(varp)  
zp<-(p1 - p2)/stdp 
zp
1-pnorm(zp)
```

When conducting a two-tail z-test with a 5% level of risk of a type 1 error, the critical values are -1.96 and +1.96. The z-value of -0.4950738 falls within this confidence interval, thus we fail to reject the null hypothesis that there is no difference between the proportion of patients that died with versus without previous admission to an ICU within 6 months of the current admission. 

Further, since the p-value of 0.689726 is greater than 0.05, we, again, fail to reject the null hypothesis that there is no difference between the proportion of patients that died whether or not they were previously admitted to the ICU within the past 6 months.

Lastly, we see from the table that there was a lower percentage of patients that died with no prior ICU admission than patients that died with prior ICU admission.

Vital status by Type

Ho: there is no difference between the proportion of patients that died in the elective admission group versus the emergency admission group, risk = 0.05
Ha: there is a difference between the proportion of patients that died in the elective admission group versus the emergency admission group

```{r}
pacman::p_load(sjPlot)
sjt.xtab(ICU$Status, ICU$Type, show.col.prc = TRUE)
```

```{r}
x1<-2; x2<-38; n1<-53; n2<-147
p1<-x1/n1; p2<-x2/n2
p<-(x1+x2)/(n1+n2)  
varp<-p*(1-p)*(1/n1 + 1/n2)  
stdp<-sqrt(varp)  
zp<-(p1 - p2)/stdp 
zp
pnorm(zp)
```

When conducting a two-tail z-test with a 5% level of risk of a type 1 error, the critical values are -1.96 and +1.96. The z-value of -3.444743 does not fall within this confidence interval, thus we reject the null hypothesis that there is no difference between the proportion of patients that died in the elective admission group versus the emergency admission group.

Further, since the p-value of 0.000285801 is less than 0.05, we, again, reject the null hypothesis that the proportions of the two groups are equal. 

We can see from the table that the emergency admission type had a higher proportion of deaths than the elective admission type did.

We will now conduct a prop.test for categorical variables where the independent variable has more than 2 subgroups.

Vital status by Age

Ho: there is no difference between the proportion of patients that died across the 5 age groups, risk = 0.05
Ha: the proportion of patients that died is different in at least one of the 5 age groups

Binning the Age variable with equal-count bins.
```{r}
ICU$Age.binned <- 
  with(ICU, binVariable(Age,
   bins=5, method='proportions', 
  labels=c('Group 1','Group 2','Group 3',
  'Group 4','Group 5')))
```

```{r}
pacman::p_load(sjPlot)
sjt.xtab(ICU$Status, ICU$Age.binned, show.col.prc = TRUE)
```

```{r}
Died  <- c( 3, 8, 9, 11, 9 )
Total <- c( 41, 39, 43, 44, 33 )
prop.test(Died, Total)
```

Since the p-value of 0.2044 is greater than 0.05, we fail to reject the null hypothesis that there is no difference between the proportion of patients that died across the 5 age groups. We can see from the sample estimates that the proportions are indeed quite similar between the 5 age groups. However, the number of patients that died in age group 1 (the youngest age group) is much lower than the rest. The greatest proportion of patients that died is in group 5 (the oldest age group). The proportions in groups 2 and 3 are quite similar and slightly higher in group 4. However, overall, most of the groups had similar proportions of patients that died, aside from the youngest age group.

Further, when conducting a chi-square test with a 5% level of risk of a type 1 error and 4 degrees of freedom, the critical value is 9.49. Since the chi-squared value of 5.93 is less than this critical value, we, again, fail to reject the null hypothesis that there is no difference between the proportion of patients that died across the 5 age groups.


Vital status by Systolic Blood Pressure

Ho: there is no difference between the proportion of patients that died across the 6 systolic blood pressure level groups, risk = 0.05
Ha: the proportion of patients that died is different in at least one of the 6 systolic blood pressure level groups

```{r}
ICU <- 
  within(ICU, {
  Systolic.grouped <- Recode(Systolic, 
  '0:80="hypotension"; 80:120="normal"; 120:129="elevated"; 130:139="stage 1 hypertension"; 140:180="stage 2 hypertension"; 180:260="stage 3 hypertension"; ;',
   as.factor=TRUE)
})
```

```{r}
pacman::p_load(sjPlot)
sjt.xtab(ICU$Status, ICU$Systolic.grouped, show.col.prc = TRUE)
```

```{r}
Died  <- c( 3, 9, 9, 6, 11, 2 )
Total <- c( 17, 12, 61, 30, 65, 15 )
prop.test(Died, Total)
```

Since the p-value of 0.0001667 is less than 0.05, we will reject the null hypothesis that there is no difference between the proportion of patients that died in the 6 systolic blood pressure level groups. We can see from the sample estimates that the proportions are indeed different between the 6 groups, with the highest proportion in the hypotenstion range and in the stage 1 hypertension range. The proportions in the elevated, normal, stage 2 hypertension and stage 3 hypertension groups are much lower and are quite close to each other. Thus, the hypotension and stage 1 hypertension groups had higher proportions of patients that died. 

Further, when conducting a chi-square test with a 5% level of risk of a type 1 error and 5 degrees of freedom, the critical value is 11.07. Since the chi-squared value of 24.597 is greater than this critical value, we will, again, reject the null hypothesis that there is no difference between the proportion of patients that died in the 6 systolic blood pressure level groups.

Vital status by Heart Rate

Ho: there is no difference between the proportion of patients that died across the bradychardia, normal heart rate and elevated heart rate groups, risk = 0.05
Ha: the proportion of patients that died is different in at least one of the 3 heart rate categories

```{r}
ICU <- 
  within(ICU, {
  HeartRate.grouped <- Recode(HeartRate, 
  '0:60="bradycardia"; 60:100="normal"; 100:200="elevated"',
   as.factor=TRUE)
})
```

```{r}
pacman::p_load(sjPlot)
sjt.xtab(ICU$Status, ICU$HeartRate.grouped, show.col.prc = TRUE)
```

```{r}
Died  <- c( 3, 16, 21 )
Total <- c( 15, 80, 105 )
prop.test(Died, Total)
```

Since the p-value of 1 is greater than 0.05, we fail to reject the null hypothesis that there is no difference between proportion of patients that died across the bradychardia, normal heart rate and elevated heart rate groups. An exact p-value of 1 means that the difference in proportions of patients that died between the 3 heart rate groups is exactly 0. Thus, there were an equal number of patients that died with bradycardia, normal heart rate and elevated heart rate.

Further, when conducting a chi-square test with a 5% level of risk of a type 1 error and 2 degrees of freedom, the critical value is 5.99. Since the chi-squared value of 0 is lower than this critical value, we, again, fail to reject the null hypothesis that there is no difference between the proportion of patients that died having bradychardia, normal heart rate and elevated heart rate.

Vital status by Race

Ho: there is no difference between the proportion of patients that died that were White, Black or otherwise, risk = 0.05
Ha: the proportion of patients that died is different in at least one of the race categories

```{r}
pacman::p_load(sjPlot)
sjt.xtab(ICU$Status, ICU$Race, show.col.prc = TRUE)
```

```{r}
Died  <- c( 37, 1, 2 )
Total <- c( 175, 15, 10 )
prop.test(Died, Total)
```

Since the p-value of 0.4046 is greater than 0.05, we fail to reject the null hypothesis that there is no difference between the proportion of patients that died that were White, Black or otherwise.

Further, when conducting a chi-square test with a 5% level of risk of a type 1 error and 2 degrees of freedom, the critical value is 5.99. Since the chi-squared value of 1.8095 is less than this critical value, we, again, fail to reject the null hypothesis that there is no difference between the proportion of patients that died that were White, Black or otherwise.

When looking at the sample estimates and at the table, we see that there was almost no difference between the proportion of White patients that died and the proportion of 'Other' patients that died. However, the proportion of Black patients that died was slightly lower than the White and 'Other' groups.

Vital status by Consciousness

Ho: there is no difference between the proportion of patients that died across the Conscious, Deep Stupor and Coma groups, risk = 0.05
Ha: the proportion of patients that died is different in at least one of the Conscious, Deep Stupor and Coma groups

```{r}
pacman::p_load(sjPlot)
sjt.xtab(ICU$Status, ICU$Consciousness, show.col.prc = TRUE)
```

```{r}
Died  <- c( 27, 5, 8 )
Total <- c( 185, 5, 10 )
prop.test(Died, Total)
```

Since the p-value of 1.091e-10 is less than 0.05, we will reject the null hypothesis that there is no difference between the proportion of patients that died across the Conscious, Deep Stupor and Coma groups. 

Further, when conducting a chi-square test with a 5% level of risk of a type 1 error and 2 degrees of freedom, the critical value is 5.99. Since the chi-squared value of 45.878 is greater than this critical value, we will, again, reject the null hypothesis that there is no difference between the proportion of patients that died across the 3 Consciousness groups.

With a proportion of 1, the Deep Stupor group had the highest proportion of patients that died as all the patients with a deep stupor died. The Coma group has the second highest proportion of patients that died with a sample estimate of 80% dying. The lowest number of deaths was in the group of patients that had no coma or stupor, which is expected. Those with a deep stupor had a higher proportion of deaths than those in a coma.

From the tests of equal proportions, we note that the the following variables had a statistically significant impact on the Vital status of the patient: Service (type of procedure), Type (of admission) and Conciousness.

The following variables were not significant predictors of Vital status of the patient:  Cancer, Previous (ICU admission within the last 6 months), Age, Systolic Blood Pressure, Heart Rate and Race.